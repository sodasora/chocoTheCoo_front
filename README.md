# We Are ChocoTheCoo

<a href="ChocoTheCoo.com"></a>
소중한 사람에게 초콜릿으로 당신의 마음을 전해보세요! <br>

초코더쿠가 당신의 사랑을 응원합니다.<br>
ChcoTheCoo supports your LOVE!!

## 🖥️ PROJECT
초코더쿠 Django 쇼핑몰 프로젝트 

<img width="70%" src="https://github-production-user-asset-6210df.s3.amazonaws.com/126075796/248138972-b19ae905-ed37-4a93-88cd-0e00aef913c9.gif?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAIWNJYAX4CSVEH53A%2F20230623%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20230623T024057Z&X-Amz-Expires=300&X-Amz-Signature=02814e98c9d15858884965a8286a5319a4823edcb95d084774672e8902619064&X-Amz-SignedHeaders=host&actor_id=126075796&key_id=0&repo_id=649973176">
<br>

> ERD Cloud <br>
<img width="70%" src="https://file.notion.so/f/s/4e44da70-4514-4d0e-80dd-c7c18f16dc14/chocothecoo_(3).png?id=01f25153-1f8c-4975-bbd1-9c0f05418202&table=block&spaceId=47ec5834-9681-4c25-8b74-a3b557f326ea&expirationTimestamp=1687583319889&signature=1hUWk6nNJoAMmF0nt027pQnIwLJ58V-AZWIo77mVPk4&downloadName=chocothecoo+%283%29.png">
<br>
 
## 🕰️DEVELOPMENT PERIOD

* 22.06.05일 - 22.07.11일

### 🧑‍🤝‍🧑 MEMBER

 - 리더  : 우소라 - 프로젝트 기획, 상품 CRUD 및 프론트, 카테고리CR 및 프론트, 리뷰 CRU 프론트 구현, 검색기능 프론트, 통합 및 형상관리, 발표
 - 부리더 : 김지수 - 결제기능(포인트 충전), 포인트 CRU, 실시간 채팅기능,
 마이페이지(달력, 찜목록보기, 포인트조회, 프로필, 내리뷰보기), 구독 기능(프론트(광고 및 초코구독안내문), 백엔드CRU(구독 자동갱신)), 
 프론트 페이지네이션, 결제 테스트코드, 채팅 테스트코드
 - 팀원1 : 김광운 - 리뷰 CRUD, 장바구니 CRUD, 주문내역 CR, 주문상품 CR, 주문상태 R, 커스텀 퍼미션, 테스트 코드(상품, 리뷰, 장바구니, 주문), fixture 생성, 백엔드 상품 정렬 및 필터링(카테고리, 검색, 페이지네이션), 프론트(장바구니, 구매내역, 구매내역 상세, 장바구니 담기, 상품 좋아요, 주문하기)
 - 팀원2 : 문영오 - 헤더&푸터, 판매자통계페이지(판재자정보,판매통계정보), 판매자별주문현황조회(주문상태변경), 판매자별상품현황조회, 배포
 - 팀원3 : 손성수 - 사용자 정보 CRUD, 판매자 정보 CRUD, 배송지 정보 CRUD, 이메일 핸드폰 인증, 소셜 로그인, 개인 정보 암·복호화, 팔로우, 리뷰 좋아요, 상품 찜, 이메일 및 핸드폰 메시지 발송

### 🔩 ARCHITECTURE
<img src="https://i.postimg.cc/wBm2wqRR/architecture.png">

### 📚 STACK
* 백엔드
<img src="https://img.shields.io/badge/Python 3.11-3776AB?style=for-the-badge&logo=python&logoColor=white">
<img src="https://img.shields.io/badge/Django 4.2.2-092E20?style=for-the-badge&logo=django&logoColor=white">
<br>
<img src="https://img.shields.io/badge/djangorestframework-092E20?style=for-the-badge&logo=django&logoColor=white">
<img src="https://img.shields.io/badge/djangorestframework-simplejwt-색상?style=for-the-badge&logo=django&logoColor=white">
<br>
<img src="https://img.shields.io/badge/daphne-303030?style=for-the-badge&logo=daphne&logoColor=white"> 
<img src="https://img.shields.io/badge/redis 7.0.11-FF1F1F?style=for-the-badge&logo=redis&logoColor=white">
<!-- <img src="https://img.shields.io/badge/Celery-37814A?style=for-the-badge&logo=celery&logoColor=white"> -->

* 프론트엔드
<img src="https://img.shields.io/badge/JavaScript-F7DF1E?style=for-the-badge&logo=javascript&logoColor=white">
<img src="https://img.shields.io/badge/CSS-F43059?style=for-the-badge&logo=cssmodules&logoColor=white">
<img src="https://img.shields.io/badge/HTML-E34F26?style=for-the-badge&logo=html5&logoColor=white">

* 배포 
<img src="https://img.shields.io/badge/AWS EC2-FF9900?style=for-the-badge&logo=amazonec2&logoColor=white">
<img src="https://img.shields.io/badge/Docker-2496ED?style=for-the-badge&logo=docker&logoColor=white">
<img src="https://img.shields.io/badge/Gunicorn-499848?style=for-the-badge&logo=gunicorn&logoColor=white">

## ⚙️ TOOLS 
<img src="https://img.shields.io/badge/Figma-F24E1E?style=for-the-badge&logo=figma&logoColor=white">
<img src="https://img.shields.io/badge/Git-F05032?style=for-the-badge&logo=git&logoColor=white">

## 💬 COLLABORATIONS
<img src="https://img.shields.io/badge/GitHub-181717?style=for-the-badge&logo=github&logoColor=white">
<img src="https://img.shields.io/badge/Slack-4A154B?style=for-the-badge&logo=slack&logoColor=white">
<img src="https://img.shields.io/badge/Notion-000000?style=for-the-badge&logo=notion&logoColor=white">

## 🚩 INSTALLATION
<br>

> python = "^3.11" <br>
>* 가독성과 확장성, 다양한 라이브러리 기능 지원 <br>

> djangorestframework = "3.14.0" <br>
>* Serializer, 데이터 직렬화, 유저 관리, REST API 등 Django에서 제공하는 다양한 기능들을 사용하기 위해 채용 <br>

> requests = "^2.31.0" <br>
>* GET, POST, PUT, DELETE 등 다양한 HTTP 메소드 지원 <br>
>* 소셜 로그인, 이메일 및 휴대폰 메시지 전송, 결제 관련 기능의 API 기능 채택 <br>

> djangorestframework-simplejwt = "^5.2.2" <br>
>* 유저 인증을 토큰방식으로 암호화하기 위해 사용 <br>

> python-dotenv = "^1.0.0" <br>
>* 공유되어선 안되는 민감한 정보를 환경 변수를 통해 관리 <br>

> django-cors-headers = "^4.0.0" <br>
>* CORS 정책 관리, API 연결을 위해 채택 프brr>

> pillow = "^9.5.0" <br>
>*이미지 처리 및 조작 기능을 제공명 <br
>* 이미지 포맷 기능을 이용하여 이미지 필드 데이터 생성 <br>

> pycryptodome = "^3.18.0" <br>
>* 보안 기능을 위해 다양한 암·복호화 기능 지원, 그중 AES 대칭키 알고리즘 챝 <br>

> django-environ = "^0.10.0" <br>
>* 설정 값들을 표준화된 방식으로 가져오고 관리<br>
>* 환경 변수를 사용하여 프로젝트의 중요 정보를 외부에서 쉽게 가져올 수 없도록 보안을 강화<br>

> black = "^23.3.0" <br>
>* 개발 환경 내에서 통일된 포맷팅을 사용하여, 충돌을 방지하기 위해 사용 <br>

>redis = "^4.5.5" <br>
>* 오픈 소스의 인 메모리 데이터 구조 저장소(데이터베이스) <br>

> channels-redis = "^4.1.0" <br>
>* Redis 채널 레이어
>* Django Channels의 내장 메시지 브로커로 Redis를 사용
>* Redis에서 Pub/Sub(게시-구독) 패턴을 사용하여 Django Channels에서 처리하는 WebSocket 연결 및 비동기 처리와 같은 작업에 이용
>* 채팅 서비스에서는 프로세스간 통신에 필요, 프로세스 간 통신을 위해 사용

> channels = {version = ">=4.0.0,<4.1.0", extras = ["daphne"]} <br>
>* 실시간 비동기로 들어오는 ws/wss 프로토콜을 장고에서 대응하기 위해 사용 
>* channels: 장고 통합 레이어
>* daphne: ASGI 서버(장고/채널스 개발서버)
<br>
---
<br>

## 📌 주요 기능
#### 로그인 - <a href="https://chocothecoo.com/login.html" >상세보기</a>
<br>

> DRF Simple JWT <br>
>* Token 기반 인증 <br>
Requset, Response 의 인증 방식을 Token으로 구현 <br>
stateless한 특성을 통해 Clinet Server의 부하를 줄일것을 기대 가능 <br>
<br>
>* 확장성 <br>
payload에 사용자 간단한 데이터를 추가하여 <br>
프론트와 서비스 통합시 편리한 데이터 전송 가능 <br>
<br>
>* 간단한 구현 <br>
SIMPLE JWT Library를 사용함으로써 Token 인증 방식의 간단한 구현
<br>

> Social Login <br>
>* Oauth 인증 방식 구현 <br>
Resource Server와 Clinet Server의 API 통신을 통해 Redirect URI, API KEY 발급 <br>
Clinet Server는 Resurce Server로 부터 발급받은 사용자의 Access Token을 검증 <br>
검증 후 사용자에게 Client Server의 Refresh, Access Token 을 발급<br>
<br>

>* scope <br>
Resource Server로 부터 소셜 계정의 데이터 수집 <br>
email, profile image, nickname <br>
사용자의 프로필 정보 데이터 수집 <br>
<br>

>* kakao <br>
https://developers.kakao.com/docs/latest/ko/kakaologin/common
<br>

>* naver <br>
https://developers.naver.com/docs/login/devguide/devguide.md#%EB%84%A4%EC%9D%B4%EB%B2%84%20%EB%A1%9C%EA%B7%B8%EC%9D%B8-%EA%B0%9C%EB%B0%9C%EA%B0%80%EC%9D%B4%EB%93%9C
<br>

>* google <br>
https://cloud.google.com/identity-platform/docs/sign-in-user-email?hl=ko <br>
---
 
#### 회원가입 - <a href="https://chocothecoo.com/signup.html" >상세보기</a>
> AbstractBaseUser<br>
>* Model field에 사용자의 다양한 데이터 공간 확보 <br>
Login Type 세분화 필드를 추가하여 소셜 계정 구분 <br>
Bollean 필드를 사용하여 계정 활성화, 관리자 및 판매자 권한 구분 <br>
<br>
>* 보안 <br>
사용자의 비밀번호를 sha256 알고리즘을 사용하여 보안성 향상 <br>
set,check password 메서드 기능 지원을 통한 손쉬운 로그인 검증<br>
<br>
>* 기능 지원 <br>
is_active, last_login 등 다양한 기능 지원을 통해 편의성 향상 <br>
<br>
>* social login <br>
unusable_password 메서드를 이용하여 소셜 계정 사용자 로직 구현
<br>
> 보안 <br>
>* 필요성 <br>
사용자의 주소지 정보, 통관 번호, 휴대폰 연락처와 판매자 정보 암·복호화 과정이 필요<br>
<br>
>* pycryptodome Library 
다양한 암호화 알고리즘중 AES 알고리즘 사용 <br>
블록 알고리즘 대칭키 AES를 사용하여 암·복호화 과정 구현
<br>
 
---
### 결제 - <a href="https://chocothecoo.com/pointcharge.html" >상세보기</a>

#### 결제검증
> 사전검증[백엔드]<br>
>* https://api.iamport.kr/payments/prepare 로 결제예정금액 사전등록<br>
>* 결제예정데이터를 데이터베이스에 저장하고 고유주문번호(merchant_uid)를 프론트엔드에 보내줌<br>

> 결제요청[프론트엔드]<br>
>* 백엔드에서 받은 고유주문번호(merchant_uid)와 함께 IMP.request_pay 호출<br>

> 사후검증[백엔드]<br>
>* 포트원 결제고유번호(imp_uid), 고유주문번호(merchant_uid)를 프론트엔드로부터 수신<br>
>* 결제 상세내역 조회를 위해 포트원 결제 단건 조회 API 요청<br>
>* 응답받은 내용을 바탕으로 실 결제 금액과 결제요청금액(데이터베이스)을 비교<br>
>* 동일하다면 포인트 충전완료<br>

> 포인트 충전페이지<br>
> <img width="30%" src="https://github.com/sodasora/chocoTheCoo/assets/126075796/74f5a591-6c59-4428-9b66-62f19b380dde">


>관련 reference:<br>
https://developers.portone.io/docs/ko/readme/get-started
<br>

---
#### 마이 페이지 - <a href="https://chocothecoo.com/mypage.html" >상세보기</a>

>포인트 통계
>* 달력을 통해 오늘 또는 날짜에 따른 포인트 내역 확인<br>
> ![스크린샷 2023-06-23 144510](https://github.com/sodasora/chocoTheCoo/assets/126075796/2db5d498-1f9f-412c-a15c-9a5ee8ade282)

> 출석인증, 구매내역, 리뷰보기 기능<br>
>* 유저의 구매내역과 리뷰내역 등 관리 가능
>* 출석인증은 하루에 한 번만 가능하도록 보안처리

>프로필 기능<br>
>* 유저 정보(찜목록 개수, 이메일, 닉네임, 포인트정보 등) 확인<br> 
>* 프로필(회원정보) 수정과 연결

>찜목록 모아보기 기능<br>
>* 관심 제품을 모아볼 수 있으며, 제품 상세페이지와 연결
>구독 정보 확인 및 관리 기능<br>
>* 다음 결제일이나 구독 상태 등을 확인 가능<br>
>* 버튼(구독/해지)은 구독 상태에 맞게 바뀜<br>
>* 구독을 하지 않은 상태에서는, 버튼을 누르면 구독등록 페이지로 연결되며, 구독 상태에서는 해지예약이 이루어짐<br>
>* 이후 다음 결제일에 해지가 이루어짐.

>페이지네이션 <br>
<br>

---
#### 채팅 - <a href="https://chocothecoo.com/chatindex.html" >상세보기</a>

> Redis 서버 구동 방법
>* Redis Enterprise Cloud free 플랜 가입
>* host, port, password 정보 확인 => 채널레이어 설정
>* 예: CHANNEL_LAYER_REDIS_URL="redis://:암호@호스트명:6379
>* .env로 관리할 것
>* 서버 구동 시 도커 활용
>* 명령어: docker run -d -restart always -name redis7 -publish 6379:6379 redis:7
<br>

> 채팅방
>* 생성과 입장
>* 채팅방 삭제(채팅방 만든 사람만 가능)
> ![스크린샷 2023-06-23 184532](https://github.com/sodasora/chocoTheCoo/assets/126075796/00867796-208a-4b7e-8342-5061ede26a4d)
>* 채팅방 실시간 채팅 (웹소켓 활용)
> ![스크린샷 2023-06-23 184243](https://github.com/sodasora/chocoTheCoo/assets/126075796/c3113b6b-133d-433e-8905-00db16b7dbe1)

---
#### 메인 페이지 - <a href="https://chocothecoo.com/" >상세보기</a>
<br>

> 상품(Products) 
>* url 쿼리 파라미터로 전달된 값에 따라 해당 상품들의 목록 조회 가능
>* 판매자 페이지, 카테고리 , 전체 상품 조회 등 일정 조건에 따라서 조회 가능하도록 구현
>* 특정 상품 클릭 시 해당 상품에 대한 정보(이름, 가격, 내용, 이미지. 수량) 보여줌
>* 장바구니, 찜 버튼 클릭 시, 해당 상품에 대한 정보들 저장됨  

> 카테고리(Category)
>* url 쿼리 파라미터로 전달된 값에 따라 해당 카테고리에 해당하는 상품들 목록 조회
>* 카테고리 조건이 있을 시에 db에 저장된 상품들의 정보 조회함
>* 카테고리에 해당하는 상품 정보들 출력하기 위해 api.js에서 통일한 함수 호출하는 방식으로 변경함 

> 사용자 친화적인 UI를 고려한 navbar
>* 판매자/구매자에 따라서 navbar 다르게 보이도록 구현하여 혼선 줄수 있는 UI 개선함
>* 로그인한 유저 id의 판매자 여부를 판별하여 해당되는 navbar를 보여줌  
>* 카테고리와는 별도로 제작됨  

---
  
#### 1대1문의 및 공지사항 - <a href="" >상세보기</a> 
<br>

---
#### 판매자 페이지  - <a herf = "https://chocothecoo.com/sellerpage.html"></a> 
<br>
<img width="70%" src="https://chocothecoo.com/static/images/sellerlogo.gif">
<br>

> 상품(Products) 
>* url 쿼리 파라미터로 전달된 값에 따라 해당 상품들의 목록 조회 가능
>* 판매자id에 해당하는  판매자 전용 상품 조회 페이지 구현
>* seller_id 와 user_id를 판별하여 동일한 경우에만 수정/삭제 가능하도록 구현

> 상품 등록
>* 상픔 등록 양식 작성 시, 이미지 미리보기 가능함
>* 동일한 페이지에서 수정도 가능하며, 이전에 작성된 상품 정보도 조회 가능

> 상품 상세 페이지 
>* seller_id 와 user_id를 판별하여 동일한 경우에만 수정/삭제 버튼 조회 가능
>* 해당 상품에 대한 후기들 조회가 가능
>* 후기 작성은 구매내역에서 가능하도록 구현했으며 작성시 상품 상세페이지에서 조회, 후기는 포인트 적립 규정때문에 삭제는 불가능 하며 사진 후기, 텍스트 후기 인지 판별하여 백엔드에서 차등한 포인트 적립 되도록 구현함 

---
#### 판매자 통계 페이지  - <a herf="https://chocothecoo.com/seller.html">상세보기</a> 
<br>

> 통계
>* 판매자별 수익,지출,평가 현황 조회가능 
>* 누적정보, 월단위 정보 조회가능

> 판매자별 상품현황 - <a herf="https://chocothecoo.com/seller_productlist.html">상세보기</a> 
>* 판매자id에 해당하는 판매자 전용 상품 현황 조회 페이지 구현
>* 해당 상품에 따른 재고수량변경 가능

> 판매자별 주문현황 - <a herf="https://chocothecoo.com/seller_orderlist.html">상세보기</a> 
>* 판매자id에 해당하는 판매자 전용 주문 현황 조회 페이지 구현
>* 해당 주문에 따른 주문상태변경 가능

---
#### 관리자 페이지 
<br>

---
#### 상품 주문하기
> 장바구니(CartItem)
>* url 쿼리 파라미터로 전달된 값에 따라 해당 상품들의 목록 조회 가능
>* 장바구니 상품 수량 변경, 삭제 기능
>* 체크된 항목 주문페이지로 넘겨주기
>* 외래키인 Product를 통해 가격 변동 반영

> 주문내역(Bill)
>* 유저의 배송정보 ID를 받아와 해당 정보로 주문서  객체 생성

> 주문상품(OrderItem)
>* 주문내역 생성과 동시에 같이 받아온 Cart_id들을 받아와서 주문 생성 요청
>* 요청 후 현재 유저의 포인트와 상품 금액을 비교해서 차감 및 포인트 적립
>* 하나의 Bill에 여러개의 OrderItem이 들어가는 OneToMany 구조
>* 받아온 Cart_id들을 bulk_create를 통해 주문 상품으로 생성
>* 해당 Bill 객체의 결제 여부를 True로 바꿔줌
 
---
#### 그 외
> 사용자 지정 권한
>* IsReadOnly
<br>GET, HEAD, OPTIONS 메소드일 경우</br>
>* IsSeller
<br>사용자가 Seller신청을 했을 경우</br>
>* IsApprovedSeller
<br>사용자가 승인된 Seller일 경우</br>
>* IsDeliveryRegistered
<br>사용자의 배송정보가 등록되어있을 경우</br>
<br>

---
 
### 🔨 기술 선정 Why ?
#### Websocket
- 실시간 채팅 기능 구현에 있어 채팅을 칠 때마다 매번 HTTP 통신을 하는 것은 느리고 비효율적이기 때문에 실시간 비동기 프로토콜을 제공하는 웹소켓 기술을 사용
#### AWS EC2
- 용량을 줄이거나 늘릴 수 있는 탄력성을 가지고 있고, 보안 및 네트워크 구성, 스토리지 관리에 효과적이며 간단한 프로젝트 배포를 프리티어로 무료로 이용할 수 있다는 점에서 채용
#### AWS S3
- 서비스에서 이미지를 업로드 할때, EC2에 저장을 하게되면 용량이 부족해지고 파일들을 관리하기가 어렵습니다. 그래서 파일 저장에 최적화 되어있고, 저장용량이 무한대에 가까운 S3를 사용해서 이미지 파일들을 저장하고 관리 했습니다.
#### Docker
- Docker는 소프트웨어를 컨테이너라는 표준화된 유닛으로 패키징하는데, 컨테이너에는 라이브러리, 시스템 도구, 코드, 런타임 등 소프트웨어를 실행하는데 필요한 모든것이 포함되어 있습니다. 이러한 특징을 가진 Docker를 활용해서 환경에 구애받지 않고 애플리케이션을 신속하게 배포 및 확장하고 규모가 달라져도 안정적으로 저렴하게 애플리케이션을 구축, 제공 및 실행 하기위해 사용했습니다.
#### Nginx
- event-driven의 비동기 구조인 특징을 가지고 있는 nginx는 채팅기능 때문에 동시접속자 수의 증가에 대응하기에 적합한 방식의 웹서버라고 생각했습니다. 또한 무중단 배포가 가능하여 채팅기능이 있는 웹사이트에서 배포시 중단되지 않는점이 사용자들에게 사용성 및 편의성을 증대시킵니다.
#### Gunicorn
- 로컬개발환경에서는 django의 runserver를 사용하여 gunicorn이 없어도 유용하게 사용 할 수 있지만, 배포환경에서는 runserver를 사용하지 않도록 django에서도 권장되어있습니다. 그래서 Python WSGI 대표적으로 성능이 검증된 Gunicorn을 활용해서 Nginx로부터 받은 서버사이드 요청을 gunicorn을 활용해서 django로 전달하게끔 했습니다.
#### Daphne
- Gunicorn이 WSGI HTTP요청을 처리한다면 저희 서비스에 있는 채팅기능은 ASGI WS 요청을 처리해야 합니다. Daphne는 Channels 를 설치하면 자동으로 설치되며 Channels에서 지원하는 서버로 ASGI 프로토콜로 받은 WS요청을 처리하려고 사용했습니다.
#### PostgreSQL
- PostgreSQL은 MySQL보다 표준에 더 가깝게 구현하는것을 목표로 두고있고, 오픈소스 및 커뮤니티가 이끄는 데이터베이스 입니다. django에서 가장 권장하는 RDBMS가 PostgreSQL이었기 때문에 이를 직접 사용해봄으로써 MySQL과는 어떠한 차이점이 있는지 공부도 하고, 다른 RDBMS를 사용해봄으로써 경험치를 쌓고자 사용했습니다.
